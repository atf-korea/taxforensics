<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LogSentinel AI - 포렌식 통합 분석기</title>
  
  <!-- 1. 스타일 (Tailwind CSS) -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- 2. 필수 라이브러리 (순서 중요: React -> ReactDOM -> Recharts) -->
  <script src="https://unpkg.com/react@18.2.0/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/recharts@2.12.3/umd/Recharts.js" crossorigin></script>
  
  <!-- 3. Babel (브라우저 내 JSX 변환) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- 4. 폰트 -->
  <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" rel="stylesheet" />

  <style>
    body { 
      background-color: #020617; 
      color: #e2e8f0; 
      font-family: 'Pretendard', sans-serif; 
      overflow: hidden; 
    }
    /* 스크롤바 */
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: #0f172a; }
    ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #475569; }
    
    /* 패널 효과 */
    .glass-panel {
      background: rgba(15, 23, 42, 0.7);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(51, 65, 85, 0.5);
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }
    
    /* 로딩 애니메이션 */
    .loader {
      border: 4px solid #1e293b;
      border-top: 4px solid #06b6d4;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
  </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.1",
    "react-dom/": "https://esm.sh/react-dom@^19.2.1/",
    "react/": "https://esm.sh/react@^19.2.1/",
    "lucide-react": "https://esm.sh/lucide-react@^0.559.0",
    "@google/genai": "https://esm.sh/@google/genai@^1.32.0",
    "recharts": "https://esm.sh/recharts@^3.5.1",
    "react-markdown": "https://esm.sh/react-markdown@^10.1.0"
  }
}
</script>
</head>
<body>
  <div id="root">
    <!-- 초기 로딩 화면 (스크립트 로드 전 표시) -->
    <div style="height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; background: #020617; color: white;">
      <div class="loader" style="margin-bottom: 20px;"></div>
      <h2>시스템 리소스 로딩 중...</h2>
    </div>
  </div>

  <!-- 에러 표시 영역 -->
  <div id="error-display" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background: #450a0a; color: #fca5a5; padding: 2rem; z-index: 9999;">
    <h2 style="font-size: 1.5rem; font-weight: bold; margin-bottom: 1rem;">시스템 오류 발생</h2>
    <p>라이브러리 로드에 실패했거나 실행 중 오류가 발생했습니다.</p>
    <pre id="error-message" style="background: rgba(0,0,0,0.3); padding: 1rem; margin-top: 1rem; border-radius: 0.5rem; white-space: pre-wrap; font-family: monospace;"></pre>
    <button onclick="location.reload()" style="margin-top: 1rem; padding: 0.5rem 1rem; background: #fff; color: #000; border: none; cursor: pointer;">새로고침</button>
  </div>

  <script>
    // 전역 에러 핸들러
    window.onerror = function(msg, url, lineNo, columnNo, error) {
      const display = document.getElementById('error-display');
      const msgBox = document.getElementById('error-message');
      display.style.display = 'block';
      msgBox.textContent = `Error: ${msg}\nLine: ${lineNo}\nStack: ${error ? error.stack : 'N/A'}`;
      return false;
    };
  </script>

  <script type="text/babel">
    /*******************************************************
     * LogSentinel AI - Main Logic
     *******************************************************/

    // 라이브러리가 로드될 때까지 기다리는 부트스트랩 함수
    function bootstrap() {
      if (!window.React || !window.ReactDOM || !window.Recharts) {
        // 아직 로드되지 않음, 50ms 후 재시도
        setTimeout(bootstrap, 50);
        return;
      }

      // 라이브러리 로드 완료, 앱 시작
      const { useState, useEffect, useMemo, useRef } = React;
      const { createRoot } = ReactDOM;
      const { 
        BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, 
        PieChart, Pie, Cell, LineChart, Line 
      } = window.Recharts;

      // --- 1. 아이콘 컴포넌트 (SVG 인라인) ---
      const Icons = {
        Activity: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>,
        Clock: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
        LayoutDashboard: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="7" height="9" x="3" y="3" rx="1"/><rect width="7" height="5" x="14" y="3" rx="1"/><rect width="7" height="9" x="14" y="12" rx="1"/><rect width="7" height="5" x="3" y="16" rx="1"/></svg>,
        ScanSearch: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 12a9 9 0 1 1-6.219-8.56"/><path d="M21 21l-4.35-4.35"/></svg>,
        BrainCircuit: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z"/><path d="M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z"/><path d="M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4"/></svg>,
        LogOut: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></svg>,
        UploadCloud: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242"/><path d="M12 12v9"/><path d="m16 16-4-4-4 4"/></svg>,
        Download: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>,
        Play: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="5 3 19 12 5 21 5 3"/></svg>,
        Usb: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="10" cy="7" r="1"/><circle cx="4" cy="20" r="1"/><path d="M4.7 19.3 19 5"/><path d="m21 3-3 1 2 2Z"/></svg>,
        FileText: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/></svg>,
        FolderOpen: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m6 14 1.45-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.55 6a2 2 0 0 1-1.94 1.5H4a2 2 0 0 1-2-2V5c0-1.1.9-2 2-2h3.93a2 2 0 0 1 1.66.9l.82 1.2a2 2 0 0 0 1.66.9H18a2 2 0 0 1 2 2v2"/></svg>,
        ShieldAlert: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></svg>,
        Send: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/></svg>,
        Bot: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 8V4H8"/><rect width="16" height="12" x="4" y="8" rx="2"/><path d="M2 14h2"/><path d="M20 14h2"/><path d="M15 13v2"/><path d="M9 13v2"/></svg>,
        User: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
      };

      // --- 2. 데이터 유틸리티 ---
      const LogCategory = {
        PRODUCTIVITY: '생산성', ENTERTAINMENT: '엔터테인먼트', SYSTEM: '시스템',
        COMMUNICATION: '커뮤니케이션', DEVELOPMENT: '개발', UNCATEGORIZED: '기타'
      };
      const ArtifactType = { USB: 'USB 장치', DOC: '최근 문서', SHELL: '셸백(폴더)' };

      // 모의 데이터 생성기
      const createMockData = () => {
        const logs = [];
        const apps = [
          { n: 'Visual Studio Code', c: LogCategory.DEVELOPMENT },
          { n: 'Chrome', c: LogCategory.UNCATEGORIZED },
          { n: 'Excel', c: LogCategory.PRODUCTIVITY },
          { n: 'Slack', c: LogCategory.COMMUNICATION },
          { n: 'Netflix', c: LogCategory.ENTERTAINMENT }
        ];
        for(let i=0; i<40; i++) {
          const app = apps[Math.floor(Math.random()*apps.length)];
          logs.push({
            id: i, timestamp: new Date(Date.now() - Math.random()*86400000*3).toISOString(),
            app: app.n, title: `${app.n} - 활성 창 ${i}`, duration: Math.floor(Math.random()*3000)+60, category: app.c
          });
        }
        return logs;
      };

      const createArtifacts = () => [
        { id:1, type: ArtifactType.USB, name: 'Samsung T7 Shield', path: 'Serial: S5T7NS0R123', risk: 'LOW', time: new Date().toISOString() },
        { id:2, type: ArtifactType.USB, name: 'Unknown Flash Drive', path: 'Serial: X8921-MAL', risk: 'HIGH', time: new Date().toISOString() },
        { id:3, type: ArtifactType.DOC, name: '기밀_인수합병_보고서.docx', path: 'C:/Users/Admin/Desktop/Secret', risk: 'HIGH', time: new Date().toISOString() },
        { id:4, type: ArtifactType.DOC, name: '휴가계획.xlsx', path: 'D:/Documents', risk: 'LOW', time: new Date().toISOString() },
        { id:5, type: ArtifactType.SHELL, name: 'Tor Browser', path: 'Downloads/Tor', risk: 'HIGH', time: new Date().toISOString() }
      ];

      // --- 3. UI 컴포넌트 ---

      // [대시보드]
      const Dashboard = ({ logs }) => {
        const stats = useMemo(() => {
          if(!logs.length) return null;
          const total = (logs.reduce((a,b)=>a+b.duration,0)/3600).toFixed(1);
          const catData = Object.values(LogCategory).map(c => ({
            name: c, value: logs.filter(l=>l.category===c).reduce((a,b)=>a+b.duration,0)
          })).filter(d=>d.value>0);
          return { total, catData };
        }, [logs]);

        if(!stats) return <div className="text-slate-500">데이터가 없습니다.</div>;

        return (
          <div className="space-y-6 animate-fade-in">
            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div className="glass-panel p-6 rounded-xl flex justify-between items-center">
                <div><p className="text-slate-400 text-sm">총 분석 시간</p><h3 className="text-3xl font-bold text-white">{stats.total}h</h3></div>
                <Icons.Clock width={40} className="text-cyan-500 opacity-50"/>
              </div>
              <div className="glass-panel p-6 rounded-xl flex justify-between items-center">
                <div><p className="text-slate-400 text-sm">로그 항목 수</p><h3 className="text-3xl font-bold text-white">{logs.length}건</h3></div>
                <Icons.FileText width={40} className="text-indigo-500 opacity-50"/>
              </div>
              <div className="glass-panel p-6 rounded-xl flex justify-between items-center">
                <div><p className="text-slate-400 text-sm">생산성 점수</p><h3 className="text-3xl font-bold text-green-400">82점</h3></div>
                <Icons.Activity width={40} className="text-green-500 opacity-50"/>
              </div>
            </div>
            
            <div className="glass-panel p-6 rounded-xl h-80">
              <h3 className="text-white font-bold mb-4">카테고리별 사용 시간 (초)</h3>
              <ResponsiveContainer width="100%" height="100%">
                <BarChart data={stats.catData}>
                  <CartesianGrid strokeDasharray="3 3" stroke="#334155"/>
                  <XAxis dataKey="name" stroke="#94a3b8" fontSize={12}/>
                  <YAxis stroke="#94a3b8"/>
                  <Tooltip contentStyle={{backgroundColor:'#0f172a', borderColor:'#334155', color:'#fff'}}/>
                  <Bar dataKey="value" fill="#06b6d4" radius={[4,4,0,0]}/>
                </BarChart>
              </ResponsiveContainer>
            </div>
          </div>
        );
      };

      // [포렌식 뷰]
      const ForensicsView = ({ artifacts }) => {
        const [filter, setFilter] = useState('ALL');
        const filtered = artifacts.filter(a => filter==='ALL' || a.type===filter);

        return (
          <div className="space-y-4 animate-fade-in">
            <div className="flex gap-2 mb-4">
              {['ALL', ...Object.values(ArtifactType)].map(t => (
                <button key={t} onClick={()=>setFilter(t)} 
                  className={`px-4 py-2 rounded font-bold text-sm ${filter===t?'bg-cyan-600 text-white':'bg-slate-800 text-slate-400 border border-slate-700'}`}>
                  {t==='ALL'?'전체 보기':t}
                </button>
              ))}
            </div>
            <div className="glass-panel rounded-xl overflow-hidden">
               <table className="w-full text-sm text-left text-slate-300">
                 <thead className="bg-slate-900 text-slate-500 font-bold uppercase text-xs">
                   <tr><th className="p-4">유형</th><th className="p-4">항목명</th><th className="p-4">경로/상세</th><th className="p-4">위험도</th><th className="p-4">시간</th></tr>
                 </thead>
                 <tbody className="divide-y divide-slate-800">
                   {filtered.map((item, i) => (
                     <tr key={i} className="hover:bg-slate-800/50 transition-colors">
                       <td className="p-4 flex items-center gap-2">
                         {item.type===ArtifactType.USB ? <Icons.Usb width={16}/> : item.type===ArtifactType.DOC ? <Icons.FileText width={16}/> : <Icons.FolderOpen width={16}/>}
                         {item.type}
                       </td>
                       <td className="p-4 font-bold text-white">{item.name}</td>
                       <td className="p-4 text-slate-500 truncate max-w-xs">{item.path}</td>
                       <td className="p-4">
                         <span className={`px-2 py-1 rounded text-xs font-bold ${item.risk==='HIGH'?'bg-red-900 text-red-400':'bg-slate-800 text-slate-400'}`}>
                           {item.risk}
                         </span>
                       </td>
                       <td className="p-4 text-xs font-mono">{new Date(item.time).toLocaleString()}</td>
                     </tr>
                   ))}
                 </tbody>
               </table>
               {filtered.length===0 && <div className="p-8 text-center text-slate-500">항목이 없습니다.</div>}
            </div>
          </div>
        );
      };

      // [AI 분석]
      const AIAnalysis = ({ logs, artifacts }) => {
        const [msgs, setMsgs] = useState([{role:'ai', text:'PC 사용 기록과 포렌식 데이터를 분석했습니다. 궁금한 점을 물어보세요.'}]);
        const [input, setInput] = useState('');
        const [loading, setLoading] = useState(false);

        const send = async () => {
          if(!input.trim()) return;
          const userMsg = input; 
          setInput('');
          setMsgs(prev => [...prev, {role:'user', text:userMsg}]);
          setLoading(true);

          try {
            // Gemini API Fetch (라이브러리 없이 직접 호출)
            const apiKey = localStorage.getItem('GEMINI_KEY');
            if (!apiKey) throw new Error("API 키가 설정되지 않았습니다. (설정 메뉴 필요)");
            
            const prompt = `
              당신은 디지털 포렌식 전문가입니다.
              로그 수: ${logs.length}, 아티팩트 수: ${artifacts.length}
              질문: ${userMsg}
              
              사용자 질문에 대해 한국어로 전문적이고 간결하게 답변하세요.
            `;

            const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`, {
              method: 'POST',
              headers: {'Content-Type': 'application/json'},
              body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
            });
            
            const data = await res.json();
            const aiText = data.candidates?.[0]?.content?.parts?.[0]?.text || "응답을 생성할 수 없습니다.";
            setMsgs(prev => [...prev, {role:'ai', text: aiText}]);
          } catch (e) {
            setMsgs(prev => [...prev, {role:'ai', text: `오류: ${e.message} (데모 모드에서는 실제 AI 응답이 제한될 수 있습니다)`}]);
          } finally {
            setLoading(false);
          }
        };

        return (
          <div className="glass-panel rounded-xl h-[500px] flex flex-col animate-fade-in">
            <div className="flex-1 overflow-auto p-4 space-y-4">
              {msgs.map((m,i) => (
                <div key={i} className={`flex gap-3 ${m.role==='user'?'flex-row-reverse':''}`}>
                  <div className={`p-2 rounded-full ${m.role==='user'?'bg-indigo-500/20':'bg-cyan-500/20'}`}>
                    {m.role==='user'?<Icons.User width={20}/>:<Icons.Bot width={20}/>}
                  </div>
                  <div className={`p-3 rounded-lg max-w-[80%] text-sm whitespace-pre-wrap ${m.role==='user'?'bg-indigo-600 text-white':'bg-slate-800 text-slate-200'}`}>
                    {m.text}
                  </div>
                </div>
              ))}
              {loading && <div className="text-center text-slate-500 text-xs">AI가 생각 중입니다...</div>}
            </div>
            <div className="p-4 border-t border-slate-800 flex gap-2">
              <input 
                className="flex-1 bg-slate-900 border border-slate-700 rounded p-2 text-white" 
                value={input} onChange={e=>setInput(e.target.value)} 
                onKeyDown={e=>e.key==='Enter'&&send()}
                placeholder="질문을 입력하세요..."
              />
              <button onClick={send} className="bg-cyan-600 px-4 rounded text-white hover:bg-cyan-500">
                <Icons.Send width={20}/>
              </button>
            </div>
          </div>
        );
      };

      // [메인 앱]
      const App = () => {
        const [view, setView] = useState('UPLOAD'); // UPLOAD, DASHBOARD, FORENSICS, ANALYSIS
        const [logs, setLogs] = useState([]);
        const [artifacts, setArtifacts] = useState([]);
        const [scanning, setScanning] = useState(false);

        // 파일 업로드 처리
        const handleFile = (e) => {
          const file = e.target.files[0];
          if(!file) return;
          const reader = new FileReader();
          reader.onload = (ev) => {
            try {
              const json = JSON.parse(ev.target.result);
              if(json.logs) setLogs(json.logs);
              if(json.artifacts) {
                setArtifacts(json.artifacts);
                setView('FORENSICS'); // 아티팩트가 있으면 포렌식 뷰로 이동
              } else {
                setView('DASHBOARD');
              }
            } catch(e) { alert('JSON 파싱 오류'); }
          };
          reader.readAsText(file);
        };

        // 파워셸 스크립트 다운로드
        const downloadScript = () => {
          const script = `
  # LogSentinel 수집 스크립트
  Write-Host "PC 데이터를 수집합니다..." -ForegroundColor Cyan
  $out = @{ logs=@(); artifacts=@() }

  # 1. 최근 문서 수집
  $recent = Get-ChildItem "$env:APPDATA\\Microsoft\\Windows\\Recent" -ErrorAction SilentlyContinue | Select -First 30
  foreach($r in $recent) {
    $out.artifacts += @{ type="최근 문서"; name=$r.Name; path=$r.FullName; risk="UNKNOWN"; time=$r.LastWriteTime.ToString("o") }
  }

  # 2. USB 흔적 (간이)
  $usb = Get-PnpDevice -Class 'USB' -Status OK | Where-Object {$_.FriendlyName -notmatch 'Hub'}
  foreach($u in $usb) {
    $out.artifacts += @{ type="USB 장치"; name=$u.FriendlyName; path=$u.InstanceId; risk="MEDIUM"; time=(Get-Date).ToString("o") }
  }

  $out | ConvertTo-Json -Depth 2 | Out-File "analysis_data.json" -Encoding UTF8
  Write-Host "완료! analysis_data.json 파일을 웹사이트에 업로드하세요." -ForegroundColor Green
  Pause
          `;
          const blob = new Blob([script], {type:'text/plain'});
          const a = document.createElement('a');
          a.href = URL.createObjectURL(blob);
          a.download = 'collect_data.ps1';
          a.click();
        };

        // 시뮬레이션 실행
        const runSim = () => {
          setScanning(true);
          setTimeout(() => {
            setLogs(createMockData());
            setArtifacts(createArtifacts());
            setScanning(false);
            setView('FORENSICS');
          }, 2500);
        };

        // 스캔 중 화면
        if(scanning) return (
          <div className="min-h-screen bg-[#020617] flex flex-col items-center justify-center">
            <div className="loader mb-6"></div>
            <h2 className="text-2xl font-bold text-white mb-2">포렌식 정밀 분석 중...</h2>
            <p className="text-slate-400">USB 히스토리 및 Shellbag 파싱 중</p>
            <div className="w-64 bg-slate-800 rounded-full h-2 mt-4 overflow-hidden">
              <div className="bg-cyan-500 h-full animate-[width_2s_ease-in-out] w-full"></div>
            </div>
          </div>
        );

        // 업로드 화면
        if(view === 'UPLOAD') return (
          <div className="min-h-screen flex items-center justify-center p-4">
            <div className="glass-panel max-w-2xl w-full p-8 rounded-2xl text-center">
              <div className="flex justify-center mb-6">
                <div className="p-4 bg-cyan-500/10 rounded-full text-cyan-400 border border-cyan-500/20">
                  <Icons.Activity width={48} height={48}/>
                </div>
              </div>
              <h1 className="text-4xl font-bold text-white mb-2">LogSentinel AI</h1>
              <p className="text-slate-400 mb-8">PC 사용 로그 및 디지털 포렌식 분석 도구</p>
              
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <label className="cursor-pointer border-2 border-dashed border-slate-700 hover:border-cyan-500 hover:bg-slate-800/50 rounded-xl p-8 transition-all group">
                  <input type="file" className="hidden" onChange={handleFile} accept=".json"/>
                  <Icons.UploadCloud width={32} className="mx-auto mb-2 text-slate-500 group-hover:text-cyan-400"/>
                  <div className="font-bold text-white">데이터 업로드</div>
                  <div className="text-xs text-slate-500 mt-1">.json 파일</div>
                </label>

                <div className="space-y-3">
                   <button onClick={downloadScript} className="w-full py-3 bg-slate-800 border border-slate-700 text-slate-300 hover:text-white rounded-lg flex items-center justify-center gap-2 font-bold text-sm">
                     <Icons.Download width={16}/> 실제 데이터 수집 스크립트
                   </button>
                   <button onClick={runSim} className="w-full py-3 bg-gradient-to-r from-cyan-600 to-blue-600 text-white rounded-lg flex items-center justify-center gap-2 font-bold shadow-lg hover:shadow-cyan-500/20 transition-all">
                     <Icons.ScanSearch width={16}/> 포렌식 시뮬레이션 시작
                   </button>
                   <button onClick={()=>{setLogs(createMockData()); setView('DASHBOARD');}} className="text-slate-500 text-xs hover:text-slate-300 underline">
                     일반 로그 데모 보기
                   </button>
                </div>
              </div>
            </div>
          </div>
        );

        // 메인 대시보드 레이아웃
        return (
          <div className="flex h-screen bg-[#020617] text-slate-100">
            <aside className="w-64 bg-slate-900 border-r border-slate-800 flex flex-col">
              <div className="p-6 text-xl font-bold text-white flex gap-2 items-center">
                <Icons.Activity className="text-cyan-500"/> LogSentinel
              </div>
              <nav className="flex-1 p-4 space-y-2">
                <button onClick={()=>setView('DASHBOARD')} className={`w-full text-left p-3 rounded flex gap-3 items-center ${view==='DASHBOARD'?'bg-cyan-500/10 text-cyan-400 border border-cyan-500/20':'text-slate-400 hover:text-white hover:bg-slate-800'}`}>
                  <Icons.LayoutDashboard width={18}/> 대시보드
                </button>
                {artifacts.length > 0 && (
                  <button onClick={()=>setView('FORENSICS')} className={`w-full text-left p-3 rounded flex gap-3 items-center ${view==='FORENSICS'?'bg-red-500/10 text-red-400 border border-red-500/20':'text-slate-400 hover:text-white hover:bg-slate-800'}`}>
                    <Icons.ScanSearch width={18}/> 포렌식 결과
                  </button>
                )}
                <button onClick={()=>setView('ANALYSIS')} className={`w-full text-left p-3 rounded flex gap-3 items-center ${view==='ANALYSIS'?'bg-indigo-500/10 text-indigo-400 border border-indigo-500/20':'text-slate-400 hover:text-white hover:bg-slate-800'}`}>
                  <Icons.BrainCircuit width={18}/> AI 분석
                </button>
              </nav>
              <div className="p-4 border-t border-slate-800">
                <button onClick={()=>setView('UPLOAD')} className="w-full flex items-center gap-2 p-2 text-red-400 hover:bg-red-950/30 rounded">
                  <Icons.LogOut width={16}/> 세션 종료
                </button>
              </div>
            </aside>
            
            <main className="flex-1 p-8 overflow-auto relative">
               <header className="flex justify-between items-center mb-8 pb-4 border-b border-slate-800">
                 <h2 className="text-2xl font-bold text-white">
                   {view==='DASHBOARD' && '통합 대시보드'}
                   {view==='FORENSICS' && <span className="text-red-400">디지털 포렌식 리포트</span>}
                   {view==='ANALYSIS' && <span className="text-indigo-400">AI 지능형 분석</span>}
                 </h2>
                 <div className="flex gap-2 text-xs">
                   <span className="px-2 py-1 bg-slate-800 rounded text-slate-400">Logs: {logs.length}</span>
                   <span className="px-2 py-1 bg-slate-800 rounded text-slate-400">Artifacts: {artifacts.length}</span>
                 </div>
               </header>

               {view==='DASHBOARD' && <Dashboard logs={logs}/>}
               {view==='FORENSICS' && <ForensicsView artifacts={artifacts}/>}
               {view==='ANALYSIS' && <AIAnalysis logs={logs} artifacts={artifacts}/>}
            </main>
          </div>
        );
      };

      const root = createRoot(document.getElementById('root'));
      root.render(<App />);
    }

    // 앱 실행 시작 (로딩 대기)
    bootstrap();
  </script>
</body>
</html>
