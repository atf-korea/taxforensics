
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LogSentinel AI - 통합 포렌식 분석기</title>
  
  <!-- 1. 스타일시트 (Tailwind CSS) - CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- 2. 필수 라이브러리 (UMD 방식: 브라우저 호환성 100% 보장) -->
  <script src="https://unpkg.com/react@18.2.0/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/recharts@2.12.3/umd/Recharts.js" crossorigin></script>
  <!-- JSX 컴파일러 (Babel Standalone) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- 3. 한글 폰트 (Pretendard) -->
  <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" rel="stylesheet" />

  <style>
    /* 기본 테마 및 스타일 설정 */
    body { 
      background-color: #020617; 
      color: #e2e8f0; 
      font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif; 
      overflow: hidden; 
    }
    
    /* 커스텀 스크롤바 */
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: #0f172a; }
    ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #475569; }
    
    /* 유리 효과 패널 (Glassmorphism) */
    .glass-panel {
      background: rgba(15, 23, 42, 0.7);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(51, 65, 85, 0.5);
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }
    
    /* 애니메이션 유틸리티 */
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
    
    .loading-spin { animation: spin 1s linear infinite; }
    @keyframes spin { 100% { transform: rotate(360deg); } }
  </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.1",
    "react-dom/": "https://esm.sh/react-dom@^19.2.1/",
    "react/": "https://esm.sh/react@^19.2.1/",
    "lucide-react": "https://esm.sh/lucide-react@^0.559.0",
    "@google/genai": "https://esm.sh/@google/genai@^1.32.0",
    "recharts": "https://esm.sh/recharts@^3.5.1",
    "react-markdown": "https://esm.sh/react-markdown@^10.1.0"
  }
}
</script>
<link rel="stylesheet" href="/index.css">
</head>
<body>
  <!-- React 앱이 마운트될 루트 엘리먼트 -->
  <div id="root"></div>

  <!-- React 애플리케이션 로직 -->
  <script type="text/babel">
    /********************************************************************************
     * [LogSentinel AI Single File Edition]
     * 모든 컴포넌트, 로직, 스타일, 아이콘이 이 스크립트 블록 하나에 통합되어 있습니다.
     * 외부 의존성을 최소화하여 실행 오류를 방지했습니다.
     ********************************************************************************/

    // --- 0. 전역 객체 및 헬퍼 설정 ---
    const { useState, useEffect, useMemo, useRef, Fragment } = React;
    const { createRoot } = ReactDOM;
    
    // Recharts 라이브러리에서 필요한 컴포넌트 추출
    const { 
      BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, 
      PieChart, Pie, Cell, LineChart, Line, AreaChart, Area 
    } = window.Recharts;

    // API 키 가져오기 (로컬 스토리지 사용)
    const getApiKey = () => localStorage.getItem('GEMINI_API_KEY') || '';

    // --- 1. 아이콘 컴포넌트 (SVG 직접 구현 - 로딩 실패 방지) ---
    // Lucide 아이콘을 SVG로 직접 구현하여 외부 라이브러리 의존성을 제거했습니다.
    const Icons = {
      Activity: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>,
      Clock: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
      CheckCircle: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>,
      Coffee: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 8h1a4 4 0 1 1 0 8h-1"/><path d="M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z"/><line x1="6" x2="6" y1="2" y2="4"/><line x1="10" x2="10" y1="2" y2="4"/><line x1="14" x2="14" y1="2" y2="4"/></svg>,
      AlertTriangle: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" x2="12" y1="9" y2="13"/><line x1="12" x2="12.01" y1="17" y2="17"/></svg>,
      LayoutDashboard: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="7" height="9" x="3" y="3" rx="1"/><rect width="7" height="5" x="14" y="3" rx="1"/><rect width="7" height="9" x="14" y="12" rx="1"/><rect width="7" height="5" x="3" y="16" rx="1"/></svg>,
      ScanSearch: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 7V5a2 2 0 0 1 2-2h2"/><path d="M17 3h2a2 2 0 0 1 2 2v2"/><path d="M21 17v2a2 2 0 0 1-2 2h-2"/><path d="M7 21H5a2 2 0 0 1-2-2v-2"/><circle cx="12" cy="12" r="3"/><path d="m16 16-1.9-1.9"/></svg>,
      BrainCircuit: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z"/><path d="M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z"/><path d="M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4"/><path d="M17.599 6.5a3 3 0 0 0 .399-1.375"/><path d="M6.003 5.125A3 3 0 0 0 6.401 6.5"/><path d="M3.477 10.896a4 4 0 0 1 .585-.396"/><path d="M19.938 10.5a4 4 0 0 1 .585.396"/><path d="M6 18a4 4 0 0 1-1.97-3.284"/><path d="M17.97 14.716A4 4 0 0 1 16 18"/></svg>,
      FileText: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/><path d="M10 9H8"/><path d="M16 13H8"/><path d="M16 17H8"/></svg>,
      LogOut: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></svg>,
      UploadCloud: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242"/><path d="M12 12v9"/><path d="m16 16-4-4-4 4"/></svg>,
      ShieldAlert: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z"/><path d="M12 8v4"/><path d="M12 16h.01"/></svg>,
      Usb: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="10" cy="7" r="1"/><circle cx="4" cy="20" r="1"/><path d="M4.7 19.3 19 5"/><path d="m21 3-3 1 2 2Z"/><path d="M9.26 7.68 5 12l2 5"/><path d="m10 14 5 2 3.5-3.5"/><path d="m18 12 1-1 1 1-1 1Z"/></svg>,
      FolderOpen: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m6 14 1.45-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.55 6a2 2 0 0 1-1.94 1.5H4a2 2 0 0 1-2-2V5c0-1.1.9-2 2-2h3.93a2 2 0 0 1 1.66.9l.82 1.2a2 2 0 0 0 1.66.9H18a2 2 0 0 1 2 2v2"/></svg>,
      Terminal: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="4 17 10 11 4 5"/><line x1="12" x2="20" y1="19" y2="19"/></svg>,
      Download: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>,
      Play: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="5 3 19 12 5 21 5 3"/></svg>,
      Send: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/></svg>,
      Bot: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 8V4H8"/><rect width="16" height="12" x="4" y="8" rx="2"/><path d="M2 14h2"/><path d="M20 14h2"/><path d="M15 13v2"/><path d="M9 13v2"/></svg>,
      User: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>,
      Sparkles: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275Z"/></svg>,
      Search: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>,
      FileJson: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/><path d="M10 12a1 1 0 0 0-1 1v1a1 1 0 0 1-1 1 1 1 0 0 1-1-1v-1a1 1 0 0 0-1-1"/></svg>
    };

    // --- 2. 데이터 타입 및 유틸리티 ---
    const AppView = { UPLOAD: 'UPLOAD', DASHBOARD: 'DASHBOARD', FORENSICS: 'FORENSICS', ANALYSIS: 'ANALYSIS', LOGS: 'LOGS' };
    const LogCategory = { PRODUCTIVITY: '생산성', ENTERTAINMENT: '엔터테인먼트', SYSTEM: '시스템', COMMUNICATION: '커뮤니케이션', DEVELOPMENT: '개발', UNCATEGORIZED: '기타' };
    const ArtifactType = { USB_DEVICE: 'USB_DEVICE', RECENT_DOC: 'RECENT_DOC', SHELLBAG: 'SHELLBAG' };
    const RiskLevel = { HIGH: 'HIGH', MEDIUM: 'MEDIUM', LOW: 'LOW' };

    // 날짜 포맷팅
    const formatDate = (iso) => new Date(iso).toLocaleString('ko-KR', { month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit' });

    // AI 서비스 (라이브러리 없이 순수 fetch로 구현)
    async function callGemini(apiKey, prompt) {
      if (!apiKey) return "설정된 API 키가 없습니다. 화면 상단이나 콘솔에서 설정해주세요.";
      try {
        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            contents: [{ parts: [{ text: prompt }] }],
            generationConfig: { maxOutputTokens: 2048 }
          })
        });
        
        if (!response.ok) {
           const err = await response.json();
           throw new Error(err.error?.message || 'API 호출 실패');
        }

        const data = await response.json();
        return data.candidates?.[0]?.content?.parts?.[0]?.text || "AI가 응답을 생성하지 못했습니다.";
      } catch (e) {
        return `오류 발생: ${e.message}`;
      }
    }

    // 모의 데이터 생성
    const generateMockLogs = () => {
      const logs = [];
      const apps = [
        { name: 'Visual Studio Code', cat: LogCategory.DEVELOPMENT },
        { name: 'Chrome', cat: LogCategory.UNCATEGORIZED },
        { name: 'Slack', cat: LogCategory.COMMUNICATION },
        { name: 'Excel', cat: LogCategory.PRODUCTIVITY },
        { name: 'Netflix', cat: LogCategory.ENTERTAINMENT }
      ];
      const now = new Date();
      for(let d=0; d<7; d++) {
        const date = new Date(now); date.setDate(date.getDate() - d);
        for(let i=0; i<15; i++) {
          const app = apps[Math.floor(Math.random()*apps.length)];
          const dur = Math.floor(Math.random()*3600)+300;
          logs.push({
            id: Math.random().toString(36).substr(2,9),
            timestamp: new Date(date.getTime() - Math.random()*40000000).toISOString(),
            application: app.name,
            windowTitle: `${app.name} - 작업 중 [${Math.floor(Math.random()*100)}]`,
            durationSeconds: dur,
            category: app.cat
          });
        }
      }
      return logs.sort((a,b)=>new Date(b.timestamp)-new Date(a.timestamp));
    };

    const generateForensicArtifacts = () => [
      { id: '1', type: ArtifactType.USB_DEVICE, name: 'Samsung T7 Shield', path: 'Serial: S5T7_X01...', time: new Date().toISOString(), risk: RiskLevel.LOW },
      { id: '2', type: ArtifactType.USB_DEVICE, name: 'Unknown USB', path: 'Serial: GENERIC_88...', time: new Date(Date.now()-86400000).toISOString(), risk: RiskLevel.HIGH },
      { id: '3', type: ArtifactType.RECENT_DOC, name: '기밀_프로젝트_비번.txt', path: 'C:\\Users\\Admin\\Desktop\\Secret', time: new Date(Date.now()-3600000).toISOString(), risk: RiskLevel.HIGH },
      { id: '4', type: ArtifactType.SHELLBAG, name: 'Tor Browser', path: 'Downloads/Tor', time: new Date(Date.now()-7200000).toISOString(), risk: RiskLevel.HIGH },
      { id: '5', type: ArtifactType.RECENT_DOC, name: '2024_상반기_매출.xlsx', path: 'Documents/Finance', time: new Date(Date.now()-10000000).toISOString(), risk: RiskLevel.MEDIUM },
    ];

    // --- 3. UI 컴포넌트 정의 ---

    // [컴포넌트 1] 대시보드
    const Dashboard = ({ logs }) => {
      const stats = useMemo(() => {
        const totalSec = logs.reduce((a,b)=>a+b.durationSeconds,0);
        const catMap = {};
        logs.forEach(l => catMap[l.category] = (catMap[l.category]||0) + l.durationSeconds);
        const catData = Object.entries(catMap).map(([name,value]) => ({name,value})).sort((a,b)=>b.value-a.value);
        
        const dateMap = {};
        logs.forEach(l => {
            const d = l.timestamp.split('T')[0].substring(5);
            dateMap[d] = (dateMap[d]||0) + l.durationSeconds;
        });
        const actData = Object.entries(dateMap).map(([date,sec])=>({date, hours: +(sec/3600).toFixed(1)})).sort((a,b)=>a.date.localeCompare(b.date));
        
        return { totalHours: (totalSec/3600).toFixed(1), catData, actData };
      }, [logs]);

      const COLORS = ['#06b6d4', '#8b5cf6', '#10b981', '#f59e0b', '#ef4444'];

      return (
        <div className="space-y-6 animate-fade-in pb-10">
          <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div className="glass-panel p-6 rounded-xl relative overflow-hidden">
               <div className="absolute right-0 top-0 p-4 opacity-10"><Icons.Clock width={80} height={80} className="text-cyan-500"/></div>
               <p className="text-slate-400 text-sm font-bold">총 분석 시간</p>
               <h3 className="text-3xl font-bold text-white mt-2">{stats.totalHours} <span className="text-base text-slate-500">시간</span></h3>
            </div>
            <div className="glass-panel p-6 rounded-xl relative overflow-hidden">
               <div className="absolute right-0 top-0 p-4 opacity-10"><Icons.Coffee width={80} height={80} className="text-yellow-500"/></div>
               <p className="text-slate-400 text-sm font-bold">주요 카테고리</p>
               <h3 className="text-2xl font-bold text-white mt-2 truncate">{stats.catData[0]?.name || '-'}</h3>
            </div>
            <div className="glass-panel p-6 rounded-xl relative overflow-hidden">
               <div className="absolute right-0 top-0 p-4 opacity-10"><Icons.AlertTriangle width={80} height={80} className="text-pink-500"/></div>
               <p className="text-slate-400 text-sm font-bold">분석 로그 수</p>
               <h3 className="text-3xl font-bold text-white mt-2">{logs.length} <span className="text-base text-slate-500">건</span></h3>
            </div>
          </div>

          <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div className="glass-panel p-6 rounded-xl">
              <h3 className="text-white font-bold mb-4 flex items-center gap-2"><Icons.Activity width={16} height={16} className="text-cyan-400"/> 활동 추이</h3>
              <div className="h-64">
                <ResponsiveContainer width="100%" height="100%">
                  <AreaChart data={stats.actData}>
                    <defs>
                      <linearGradient id="colorH" x1="0" y1="0" x2="0" y2="1"><stop offset="5%" stopColor="#06b6d4" stopOpacity={0.3}/><stop offset="95%" stopColor="#06b6d4" stopOpacity={0}/></linearGradient>
                    </defs>
                    <CartesianGrid strokeDasharray="3 3" stroke="#334155" vertical={false}/>
                    <XAxis dataKey="date" stroke="#94a3b8" fontSize={12}/>
                    <YAxis stroke="#94a3b8" fontSize={12}/>
                    <Tooltip contentStyle={{backgroundColor:'#0f172a', borderColor:'#334155', color:'#f1f5f9'}}/>
                    <Area type="monotone" dataKey="hours" stroke="#06b6d4" fillOpacity={1} fill="url(#colorH)"/>
                  </AreaChart>
                </ResponsiveContainer>
              </div>
            </div>
            <div className="glass-panel p-6 rounded-xl">
              <h3 className="text-white font-bold mb-4">카테고리 비율</h3>
              <div className="h-64">
                <ResponsiveContainer width="100%" height="100%">
                  <PieChart>
                    <Pie data={stats.catData} dataKey="value" nameKey="name" cx="50%" cy="50%" innerRadius={60} outerRadius={90} paddingAngle={5}>
                      {stats.catData.map((e,i)=><Cell key={i} fill={COLORS[i%COLORS.length]} stroke="none"/>)}
                    </Pie>
                    <Tooltip contentStyle={{backgroundColor:'#0f172a', borderColor:'#334155', color:'#f1f5f9'}} formatter={(v)=>(v/3600).toFixed(1)+'h'}/>
                  </PieChart>
                </ResponsiveContainer>
              </div>
            </div>
          </div>
        </div>
      );
    };

    // [컴포넌트 2] 포렌식 뷰 (사용자 요청 기능)
    const ForensicsView = ({ artifacts }) => {
      const [filter, setFilter] = useState('ALL');
      const filtered = artifacts.filter(a => filter==='ALL' || a.type===filter);
      
      const getIcon = (type) => {
        if(type === ArtifactType.USB_DEVICE) return <Icons.Usb width={16} height={16}/>;
        if(type === ArtifactType.SHELLBAG) return <Icons.FolderOpen width={16} height={16}/>;
        return <Icons.FileText width={16} height={16}/>;
      };

      return (
        <div className="space-y-6 animate-fade-in">
          <div className="flex gap-2">
            {[
              {k:'ALL', n:'전체'},
              {k:ArtifactType.USB_DEVICE, n:'USB 장치'},
              {k:ArtifactType.RECENT_DOC, n:'최근 문서'},
              {k:ArtifactType.SHELLBAG, n:'폴더 접근'}
            ].map(t => (
               <button key={t.k} onClick={()=>setFilter(t.k)} className={`px-4 py-2 rounded-lg text-sm font-bold transition-colors ${filter===t.k?'bg-cyan-600 text-white':'bg-slate-800 text-slate-400 hover:bg-slate-700'}`}>
                 {t.n}
               </button>
            ))}
          </div>
          <div className="glass-panel rounded-xl overflow-hidden">
            <table className="w-full text-sm text-left">
               <thead className="bg-slate-950 text-slate-400 text-xs uppercase font-bold">
                 <tr><th className="p-4">시간</th><th className="p-4">유형</th><th className="p-4">항목명</th><th className="p-4">경로/상세</th><th className="p-4">위험도</th></tr>
               </thead>
               <tbody className="divide-y divide-slate-800">
                 {filtered.map((item,i)=>(
                   <tr key={i} className="hover:bg-slate-800/50">
                     <td className="p-4 text-slate-500 font-mono text-xs">{formatDate(item.time)}</td>
                     <td className="p-4 text-cyan-400 font-bold text-xs flex items-center gap-2">
                       {getIcon(item.type)} {item.type.split('_')[0]}
                     </td>
                     <td className="p-4 text-white font-medium">{item.name}</td>
                     <td className="p-4 text-slate-500 max-w-xs truncate" title={item.path}>{item.path}</td>
                     <td className="p-4"><span className={`px-2 py-1 rounded text-xs font-bold ${item.risk===RiskLevel.HIGH?'bg-red-900/30 text-red-400':item.risk===RiskLevel.MEDIUM?'bg-yellow-900/30 text-yellow-400':'bg-slate-800 text-slate-400'}`}>{item.risk}</span></td>
                   </tr>
                 ))}
               </tbody>
            </table>
            {filtered.length === 0 && <div className="p-8 text-center text-slate-500">데이터가 없습니다.</div>}
          </div>
        </div>
      );
    };

    // [컴포넌트 3] AI 분석 (채팅)
    const AIAnalysis = ({ logs, artifacts }) => {
      const [msgs, setMsgs] = useState([{role:'ai', text:'데이터 분석 준비가 완료되었습니다. 생산성 패턴이나 의심스러운 파일 접근에 대해 질문해 주세요.'}]);
      const [input, setInput] = useState('');
      const [loading, setLoading] = useState(false);
      const scrollRef = useRef(null);
      
      useEffect(()=>{ if(scrollRef.current) scrollRef.current.scrollTop = scrollRef.current.scrollHeight; }, [msgs]);

      const send = async () => {
        if(!input.trim()) return;
        const q = input;
        setInput('');
        setMsgs(p => [...p, {role:'user', text:q}]);
        setLoading(true);
        
        const apiKey = getApiKey();
        const context = `
          로그 수: ${logs.length}, 포렌식 아티팩트: ${artifacts.length}.
          상위 앱: ${logs.slice(0,5).map(l=>l.application).join(', ')}.
          고위험 아티팩트: ${artifacts.filter(a=>a.risk===RiskLevel.HIGH).map(a=>a.name).join(', ')}.
        `;
        const ans = await callGemini(apiKey, `Context: ${context}\n\n질문: ${q}\n\n역할: 디지털 포렌식 전문가로서 한국어로 답변.`);
        
        setMsgs(p => [...p, {role:'ai', text: ans}]);
        setLoading(false);
      };

      return (
        <div className="glass-panel rounded-xl h-[550px] flex flex-col border border-slate-800 animate-fade-in">
           <div className="p-4 border-b border-slate-800 bg-slate-900/50 flex items-center gap-2">
             <Icons.Sparkles width={20} height={20} className="text-cyan-400"/> <span className="font-bold text-white">Gemini AI 분석관</span>
           </div>
           <div className="flex-1 overflow-y-auto p-6 space-y-4" ref={scrollRef}>
             {msgs.map((m,i)=>(
               <div key={i} className={`flex gap-3 ${m.role==='user'?'flex-row-reverse':''}`}>
                 <div className={`w-8 h-8 rounded-full flex items-center justify-center ${m.role==='user'?'bg-indigo-500/20 text-indigo-400':'bg-cyan-500/20 text-cyan-400'}`}>
                   {m.role==='user'?<Icons.User width={16}/>:<Icons.Bot width={16}/>}
                 </div>
                 <div className={`p-3 rounded-2xl max-w-[80%] text-sm leading-relaxed whitespace-pre-wrap ${m.role==='user'?'bg-indigo-600/20 text-indigo-100 rounded-tr-none border border-indigo-500/30':'bg-slate-800 text-slate-200 rounded-tl-none border border-slate-700'}`}>
                   {m.text}
                 </div>
               </div>
             ))}
             {loading && <div className="flex justify-center p-4"><Icons.Activity className="animate-spin text-cyan-500" width={24}/></div>}
           </div>
           <div className="p-4 border-t border-slate-800 flex gap-2 bg-slate-900/30">
             <input className="flex-1 bg-slate-950 border border-slate-700 rounded-lg p-3 text-white outline-none focus:border-cyan-500 transition-colors placeholder-slate-600" 
               value={input} onChange={e=>setInput(e.target.value)} onKeyDown={e=>e.key==='Enter'&&send()} placeholder="무엇이든 물어보세요... (예: 의심스러운 USB 연결이 있나요?)"/>
             <button onClick={send} className="bg-cyan-600 text-white px-5 rounded-lg hover:bg-cyan-500 transition-colors"><Icons.Send width={18}/></button>
           </div>
        </div>
      );
    };

    // [컴포넌트 4] 파일 업로드 및 홈 화면
    const FileUpload = ({ onData, onDemo, onSimulate }) => {
       const dlScript = () => {
         const code = `
# LogSentinel 수집 스크립트 (PowerShell)
$ErrorActionPreference = "SilentlyContinue"
Write-Host "PC 분석 데이터를 수집합니다..." -ForegroundColor Cyan
$out = @{ logs=@(); artifacts=@() }

# 1. 최근 문서 수집
$recent = Get-ChildItem "$env:APPDATA\\Microsoft\\Windows\\Recent" | Select -First 20
foreach($r in $recent) {
  $out.artifacts += @{ type="RECENT_DOC"; name=$r.Name; path=$r.FullName; time=$r.LastWriteTime.ToString("o"); risk="UNKNOWN" }
}

# 2. USB 흔적 (간이)
$usb = Get-PnpDevice -Class 'USB' -Status OK
foreach($u in $usb) {
  $out.artifacts += @{ type="USB_DEVICE"; name=$u.FriendlyName; path=$u.InstanceId; time=(Get-Date).ToString("o"); risk="MEDIUM" }
}

$json = $out | ConvertTo-Json -Depth 2
$json | Out-File "analysis_result.json" -Encoding UTF8
Write-Host "완료! analysis_result.json 파일이 생성되었습니다." -ForegroundColor Green
Start-Sleep -s 3
         `;
         const blob = new Blob([code], {type: 'text/plain'});
         const url = URL.createObjectURL(blob);
         const a = document.createElement('a'); a.href=url; a.download='collect_data.ps1'; a.click();
       };

       return (
         <div className="min-h-screen flex items-center justify-center p-4 relative overflow-hidden">
           {/* 배경 효과 */}
           <div className="absolute inset-0 bg-gradient-to-br from-slate-950 via-[#0f172a] to-[#020617] z-0"></div>
           <div className="absolute top-0 left-0 w-full h-full opacity-10 pointer-events-none" style={{backgroundImage: 'radial-gradient(circle at 50% 50%, #22d3ee 1px, transparent 1px)', backgroundSize: '40px 40px'}}></div>

           <div className="relative z-10 glass-panel p-10 rounded-3xl max-w-4xl w-full text-center border-slate-700 shadow-2xl animate-fade-in">
             <div className="inline-flex p-4 rounded-full bg-cyan-500/10 mb-6 border border-cyan-500/20 shadow-[0_0_20px_rgba(6,182,212,0.3)]">
               <Icons.Activity width={48} height={48} className="text-cyan-400"/>
             </div>
             <h1 className="text-5xl font-bold text-white mb-2 tracking-tight">LogSentinel <span className="text-cyan-400">AI</span></h1>
             <p className="text-slate-400 mb-10 text-lg">지능형 디지털 포렌식 및 로그 분석 플랫폼</p>
             
             <div className="grid grid-cols-1 md:grid-cols-2 gap-8 text-left">
               {/* 왼쪽: 업로드 */}
               <div className="border-2 border-dashed border-slate-700 rounded-2xl p-8 hover:border-cyan-500 hover:bg-slate-800/50 transition-all cursor-pointer relative group flex flex-col items-center justify-center text-center">
                 <input type="file" className="absolute inset-0 opacity-0 cursor-pointer" onChange={(e)=>{
                    const f=e.target.files[0]; if(!f)return;
                    const r=new FileReader(); 
                    r.onload=ev=>{ 
                      try{ 
                        const d=JSON.parse(ev.target.result); 
                        onData(d.logs||[], d.artifacts||[]); 
                      }catch(err){ alert('JSON 파싱 오류: 파일 형식을 확인해주세요.'); } 
                    }; 
                    r.readAsText(f);
                 }}/>
                 <div className="w-16 h-16 bg-slate-800 rounded-full flex items-center justify-center mb-4 group-hover:scale-110 transition-transform">
                   <Icons.UploadCloud width={32} height={32} className="text-slate-400 group-hover:text-cyan-400"/>
                 </div>
                 <h3 className="text-white font-bold text-xl mb-1">데이터 업로드</h3>
                 <p className="text-slate-500 text-sm">.json 로그 파일 드래그 앤 드롭</p>
                 <div className="mt-4 px-3 py-1 bg-slate-900 rounded-full text-xs text-slate-500 flex items-center gap-2 border border-slate-800">
                   <Icons.FileJson width={12}/> 분석 결과 파일 지원
                 </div>
               </div>
               
               {/* 오른쪽: 액션 버튼들 */}
               <div className="space-y-4 flex flex-col justify-center">
                 <div className="bg-slate-800/50 p-5 rounded-xl border border-slate-700">
                   <h4 className="text-white font-bold flex items-center gap-2 mb-2"><Icons.Terminal width={16} className="text-green-400"/> 실제 PC 분석</h4>
                   <p className="text-xs text-slate-400 mb-3">브라우저 보안상 직접 접근이 불가합니다. 아래 스크립트로 데이터를 추출하세요.</p>
                   <button onClick={dlScript} className="w-full py-2.5 bg-slate-700 hover:bg-slate-600 text-slate-200 rounded-lg text-sm font-bold transition-colors flex items-center justify-center gap-2">
                     <Icons.Download width={16}/> 수집 스크립트 다운로드
                   </button>
                 </div>

                 <button onClick={onSimulate} className="w-full py-4 bg-gradient-to-r from-cyan-600 to-blue-600 text-white rounded-xl font-bold shadow-lg hover:from-cyan-500 hover:to-blue-500 transition-all transform hover:-translate-y-1 flex items-center justify-center gap-2">
                   <Icons.ScanSearch width={20}/> 포렌식 시뮬레이션 시작
                 </button>
                 <button onClick={onDemo} className="w-full py-3 border border-slate-700 text-slate-400 rounded-xl hover:bg-slate-800 hover:text-white transition-colors flex items-center justify-center gap-2 font-medium">
                   <Icons.Play width={16}/> 데모 데이터 보기
                 </button>
               </div>
             </div>
           </div>
         </div>
       );
    };

    // --- 4. 메인 앱 ---
    const App = () => {
      const [view, setView] = useState(AppView.UPLOAD);
      const [logs, setLogs] = useState([]);
      const [artifacts, setArtifacts] = useState([]);
      const [scanning, setScanning] = useState(false);
      const [scanStep, setScanStep] = useState(0);

      // 모의 스캔 애니메이션
      const simulate = () => {
        setScanning(true);
        setScanStep(0);
        let step = 0;
        const interval = setInterval(() => {
          step++;
          setScanStep(step);
          if(step >= 3) {
            clearInterval(interval);
            setTimeout(() => {
              setLogs(generateMockLogs());
              setArtifacts(generateForensicArtifacts());
              setScanning(false);
              setView(AppView.FORENSICS);
            }, 800);
          }
        }, 1000);
      };

      if(scanning) return (
        <div className="min-h-screen bg-slate-950 flex flex-col items-center justify-center p-4">
           <div className="w-24 h-24 relative mb-8">
             <div className="absolute inset-0 border-4 border-slate-800 rounded-full"></div>
             <div className="absolute inset-0 border-4 border-cyan-500 rounded-full border-t-transparent animate-spin"></div>
             <div className="absolute inset-0 flex items-center justify-center"><Icons.Search width={32} className="text-cyan-400 animate-pulse"/></div>
           </div>
           <h2 className="text-2xl font-bold text-white mb-2">디지털 포렌식 스캔 중...</h2>
           <p className="text-cyan-400 font-mono text-sm">
             {scanStep===0 && "시스템 이벤트 로그 수집 중..."}
             {scanStep===1 && "Shellbags 및 레지스트리 분석 중..."}
             {scanStep===2 && "USB 연결 기록 및 문서 접근 이력 확인 중..."}
           </p>
           <div className="w-64 h-1.5 bg-slate-900 rounded-full mt-6 overflow-hidden">
             <div className="h-full bg-cyan-500 transition-all duration-500" style={{width: `${(scanStep+1)*33}%`}}></div>
           </div>
        </div>
      );

      if(view === AppView.UPLOAD) {
        return <FileUpload 
          onData={(l,a)=>{ setLogs(l); setArtifacts(a); setView(a.length?AppView.FORENSICS:AppView.DASHBOARD); }} 
          onDemo={()=>{ setLogs(generateMockLogs()); setView(AppView.DASHBOARD); }} 
          onSimulate={simulate}
        />;
      }

      return (
        <div className="flex h-screen bg-[#020617] text-slate-200">
          {/* 사이드바 */}
          <aside className="w-64 bg-slate-900/80 backdrop-blur border-r border-slate-800 flex flex-col z-20">
            <div className="p-6 text-xl font-bold text-white flex items-center gap-3 border-b border-slate-800/50">
              <Icons.Activity className="text-cyan-500" width={24}/> LogSentinel
            </div>
            <nav className="p-4 space-y-2 flex-1">
              <button onClick={()=>setView(AppView.DASHBOARD)} className={`w-full text-left p-3 rounded-lg flex items-center gap-3 transition-colors ${view===AppView.DASHBOARD?'bg-cyan-500/10 text-cyan-400 border border-cyan-500/20':'text-slate-400 hover:bg-slate-800 hover:text-white'}`}><Icons.LayoutDashboard width={18}/> 대시보드</button>
              {artifacts.length>0 && <button onClick={()=>setView(AppView.FORENSICS)} className={`w-full text-left p-3 rounded-lg flex items-center gap-3 transition-colors ${view===AppView.FORENSICS?'bg-red-500/10 text-red-400 border border-red-500/20':'text-slate-400 hover:bg-slate-800 hover:text-white'}`}><Icons.ScanSearch width={18}/> 포렌식 분석</button>}
              <button onClick={()=>setView(AppView.ANALYSIS)} className={`w-full text-left p-3 rounded-lg flex items-center gap-3 transition-colors ${view===AppView.ANALYSIS?'bg-indigo-500/10 text-indigo-400 border border-indigo-500/20':'text-slate-400 hover:bg-slate-800 hover:text-white'}`}><Icons.BrainCircuit width={18}/> AI 인텔리전스</button>
            </nav>
            <div className="p-4 border-t border-slate-800/50">
              <button onClick={()=>{setLogs([]); setArtifacts([]); setView(AppView.UPLOAD);}} className="w-full p-3 text-slate-400 hover:text-red-400 hover:bg-red-950/20 rounded-lg flex items-center gap-2 transition-colors"><Icons.LogOut width={18}/> 세션 종료</button>
            </div>
          </aside>

          {/* 메인 콘텐츠 영역 */}
          <main className="flex-1 overflow-hidden flex flex-col bg-slate-950 relative">
            {/* 배경 데코레이션 */}
            <div className="absolute top-0 right-0 w-[500px] h-[500px] bg-cyan-500/5 rounded-full blur-3xl pointer-events-none"></div>
            
            <header className="h-16 border-b border-slate-800 bg-slate-900/30 backdrop-blur flex items-center justify-between px-8 z-10">
              <h2 className="text-lg font-bold text-white flex items-center gap-2">
                {view===AppView.DASHBOARD && '통합 대시보드'}
                {view===AppView.FORENSICS && <span className="text-red-400">디지털 포렌식 리포트</span>}
                {view===AppView.ANALYSIS && <span className="text-indigo-400">AI 심층 분석</span>}
              </h2>
              <div className="text-xs text-slate-500 font-mono bg-slate-900 px-3 py-1 rounded-full border border-slate-800">
                Data: {logs.length} events | Artifacts: {artifacts.length}
              </div>
            </header>
            
            <div className="flex-1 overflow-auto p-8 relative z-10">
              {view===AppView.DASHBOARD && <Dashboard logs={logs}/>}
              {view===AppView.FORENSICS && <ForensicsView artifacts={artifacts}/>}
              {view===AppView.ANALYSIS && <AIAnalysis logs={logs} artifacts={artifacts}/>}
            </div>
          </main>
        </div>
      );
    };

    // 앱 마운트
    const root = createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
<script type="module" src="/index.tsx"></script>
</body>
</html>
    