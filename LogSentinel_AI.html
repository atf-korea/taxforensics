
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>LogSentinel AI - 디지털 포렌식 분석기</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

  <style>
    body { font-family: 'Inter', sans-serif; background-color: #020617; color: #e2e8f0; overscroll-behavior-y: none; }
    .font-mono { font-family: 'JetBrains Mono', monospace; }
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: #0f172a; }
    ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }
    .animate-fade-in { animation: fadeIn 0.5s ease-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
  </style>

  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/recharts/2.12.0/Recharts.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.1",
    "react-dom/": "https://esm.sh/react-dom@^19.2.1/",
    "react/": "https://esm.sh/react@^19.2.1/",
    "lucide-react": "https://esm.sh/lucide-react@^0.559.0",
    "recharts": "https://esm.sh/recharts@^3.5.1"
  }
}
</script>
</head>
<body>
  <div id="root" class="h-screen w-screen flex flex-col overflow-hidden bg-slate-950 text-white flex items-center justify-center">
    <div class="text-center animate-pulse">
      <div class="text-cyan-500 font-bold text-xl mb-2">시스템 초기화 중...</div>
      <div class="text-slate-500 text-sm">라이브러리 로딩 대기</div>
    </div>
  </div>

  <script type="text/babel">
    const { useState, useEffect, useMemo, useRef } = React;
    
    // ICONS (Inline SVG)
    const Icons = {
      Activity: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>,
      ShieldAlert: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>,
      BrainCircuit: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z"/><path d="M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z"/><path d="M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4"/></svg>,
      FileText: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>,
      UploadCloud: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242"/><path d="M12 12v9"/><path d="m16 16-4-4-4 4"/></svg>,
      Usb: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="10" cy="7" r="1"/><circle cx="4" cy="20" r="1"/><path d="M4.7 19.3 19 5"/><path d="m21 3-3 1 2 2Z"/><path d="M9.26 7.68 5.99 13.44"/><path d="M5 16c0-1.1.9-2 2-2h4c1.1 0 2 .9 2 2v2"/></svg>,
      FolderOpen: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m6 14 1.45-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.55 6a2 2 0 0 1-1.94 1.5H4a2 2 0 0 1-2-2V5c0-1.1.9-2 2-2h3.93a2 2 0 0 1 1.66.9l.82 1.2a2 2 0 0 0 1.66.9H18a2 2 0 0 1 2 2v2"/></svg>,
      Search: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>,
      Sparkles: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275Z"/></svg>,
      Key: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="7.5" cy="15.5" r="5.5"/><path d="m21 2-9.6 9.6"/><path d="m15.5 7.5 3 3L22 7l-3-3"/><line x1="7.5" y1="15.5" x2="7.55" y2="15.5"/></svg>,
      Save: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>,
      Send: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>,
      Terminal: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="4 17 10 11 4 5"/><line x1="12" y1="19" x2="20" y2="19"/></svg>,
      Download: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>,
      ScanSearch: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 7V5a2 2 0 0 1 2-2h2"/><path d="M17 3h2a2 2 0 0 1 2 2v2"/><path d="M21 17v2a2 2 0 0 1-2 2h-2"/><path d="M7 21H5a2 2 0 0 1-2-2v-2"/><circle cx="12" cy="12" r="3"/><path d="m16 16-1.9-1.9"/></svg>,
      LogOut: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>,
      Bot: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 2a2 2 0 0 1 2 2v2a2 2 0 0 1-2 2 2 2 0 0 1-2-2V4a2 2 0 0 1 2-2z"/><path d="M4 8a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V8z"/><path d="M9 14a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"/><path d="M15 14a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"/></svg>,
      User: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>,
      ExternalLink: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>,
      CheckCircle: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>,
      AlertTriangle: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>,
      Menu: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>,
      Clock: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
      MapPin: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>,
      FileJson: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></svg>,
      AlertCircle: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
    };

    // SERVICES (Gemini API)
    const analyzeLogsWithGemini = async (logs, artifacts, userPrompt, apiKey) => {
      if (!apiKey) throw new Error("API Key가 필요합니다.");
      
      const summary = `
        Logs Count: ${logs.length} events.
        Artifacts Count: ${artifacts.length} detected.
        USB Devices: ${artifacts.filter(a => a.type === 'USB_DEVICE').map(a => `${a.name} (${a.action})`).join(', ')}.
        High Risk Files: ${artifacts.filter(a => a.riskLevel === 'HIGH').map(a => a.name).join(', ')}.
        Recent Activities: ${logs.slice(0, 5).map(l => l.application).join(', ')}.
      `;

      try {
        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            contents: [{ parts: [{ text: `System: 당신은 디지털 포렌식 전문가입니다. 사용자의 USB 접속 기록, 파일 접근 내역, 시스템 로그를 분석하여 보안 위협을 찾아내세요.\nData Context: ${summary}\nUser Question: ${userPrompt}` }] }]
          })
        });
        if (!response.ok) throw new Error(`API 오류: ${response.status}`);
        const data = await response.json();
        return data.candidates?.[0]?.content?.parts?.[0]?.text || "분석 결과를 생성하지 못했습니다.";
      } catch (e) {
        throw new Error("AI 통신 실패: " + e.message);
      }
    };

    // COMPONENTS

    const ForensicsView = ({ artifacts }) => {
      const [filter, setFilter] = useState('ALL');
      const [searchTerm, setSearchTerm] = useState('');

      const filtered = useMemo(() => {
        return artifacts.filter(item => {
          const matchesTab = filter === 'ALL' || item.type === filter;
          const matchesSearch = item.name.toLowerCase().includes(searchTerm.toLowerCase());
          return matchesTab && matchesSearch;
        }).sort((a, b) => {
          const dateA = a.timestamp ? new Date(a.timestamp).getTime() : 0;
          const dateB = b.timestamp ? new Date(b.timestamp).getTime() : 0;
          return dateB - dateA;
        });
      }, [artifacts, filter, searchTerm]);

      const getIcon = (type) => {
        switch (type) {
          case 'USB_DEVICE': return <Icons.Usb className="w-5 h-5" />;
          case 'RECENT_DOC': return <Icons.FileText className="w-5 h-5" />;
          case 'SHELLBAG': return <Icons.FolderOpen className="w-5 h-5" />;
          default: return <Icons.AlertTriangle className="w-5 h-5" />;
        }
      };

      const getRiskColor = (risk) => {
        switch (risk) {
          case 'HIGH': return 'text-red-400 bg-red-500/10 border-red-500/20';
          case 'MEDIUM': return 'text-amber-400 bg-amber-500/10 border-amber-500/20';
          default: return 'text-slate-400 bg-slate-500/10 border-slate-500/20';
        }
      };

      return (
        <div className="space-y-6 animate-fade-in pb-20 md:pb-0">
          <div className="flex flex-col md:flex-row gap-4 justify-between items-center bg-slate-800/20 p-4 rounded-xl">
            <div className="flex gap-2 overflow-x-auto w-full md:w-auto pb-2 md:pb-0 scrollbar-hide">
              {['ALL', 'USB_DEVICE', 'RECENT_DOC', 'SHELLBAG'].map(t => (
                <button key={t} onClick={() => setFilter(t)} className={`whitespace-nowrap px-4 py-2 rounded-lg text-xs font-bold transition-all ${filter === t ? 'bg-cyan-600 text-white shadow-lg shadow-cyan-500/30' : 'bg-slate-800 text-slate-400 hover:text-white'}`}>
                  {t === 'ALL' ? '전체' : t.replace('_',' ')}
                </button>
              ))}
            </div>
            <div className="relative w-full md:w-64">
              <Icons.Search className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-500 w-4 h-4" />
              <input 
                type="text" 
                placeholder="아티팩트 검색..." 
                value={searchTerm}
                onChange={(e) => setSearchTerm(e.target.value)}
                className="w-full bg-slate-900 border border-slate-700 rounded-lg py-2 pl-9 pr-4 text-sm focus:border-cyan-500 text-white focus:outline-none focus:ring-1 focus:ring-cyan-500"
              />
            </div>
          </div>

          <div className="md:hidden space-y-4">
            {filtered.map((item, i) => (
              <div key={i} className="bg-slate-900 border border-slate-800 rounded-xl p-5 shadow-sm space-y-3">
                 <div className="flex justify-between items-start">
                    <div className="flex items-center gap-3">
                       <div className={`p-2 rounded-lg ${
                          item.type === 'USB_DEVICE' ? 'bg-cyan-500/10 text-cyan-400' :
                          item.type === 'RECENT_DOC' ? 'bg-indigo-500/10 text-indigo-400' :
                          'bg-amber-500/10 text-amber-400'
                       }`}>
                          {getIcon(item.type)}
                       </div>
                       <div>
                          <div className="text-white font-bold text-sm line-clamp-1 break-all">{item.name}</div>
                          <div className="text-[10px] text-slate-400 font-mono">{item.type}</div>
                       </div>
                    </div>
                    <span className={`px-2 py-1 rounded text-[10px] font-bold border ${getRiskColor(item.riskLevel)}`}>
                      {item.riskLevel}
                    </span>
                 </div>
                 
                 <div className="pt-3 border-t border-slate-800 space-y-2">
                    <div className="flex items-center gap-2 text-xs">
                        <Icons.Clock className="w-4 h-4 text-cyan-500 shrink-0"/>
                        <span className="text-cyan-400 font-mono font-bold">
                           <span className="text-slate-500 mr-2 font-sans font-normal">최종열람:</span>
                           {item.timestamp ? new Date(item.timestamp).toLocaleString() : '-'}
                        </span>
                    </div>
                    <div className="flex items-center gap-2 text-xs">
                        <Icons.Activity className="w-4 h-4 text-slate-500 shrink-0"/>
                        <span className="text-slate-300"><span className="text-slate-500 mr-2">행위:</span> {item.action || '알 수 없음'}</span>
                    </div>
                    <div className="flex items-start gap-2 text-xs">
                        <Icons.MapPin className="w-4 h-4 text-slate-500 shrink-0 mt-0.5"/>
                        <span className="text-slate-400 break-all leading-tight"><span className="text-slate-500 mr-2">경로:</span> {item.path}</span>
                    </div>
                 </div>
              </div>
            ))}
            {filtered.length === 0 && <div className="text-center py-10 text-slate-500 text-sm">표시할 데이터가 없습니다.</div>}
          </div>

          <div className="hidden md:block bg-slate-900 border border-slate-800 rounded-xl overflow-hidden shadow-xl">
            <div className="overflow-x-auto">
              <table className="w-full text-left text-sm text-slate-400">
                <thead className="bg-slate-950/50 text-slate-500 uppercase font-bold text-xs">
                  <tr>
                    <th className="p-4 text-cyan-500">최종활동일시</th>
                    <th className="p-4">유형</th>
                    <th className="p-4">이름</th>
                    <th className="p-4">행위 (Action)</th>
                    <th className="p-4">경로/정보</th>
                    <th className="p-4 text-right">위험도</th>
                  </tr>
                </thead>
                <tbody className="divide-y divide-slate-800/50">
                  {filtered.map((a, i) => (
                    <tr key={i} className="hover:bg-slate-800/30 transition-colors">
                      <td className="p-4 font-mono text-xs text-cyan-400 font-medium whitespace-nowrap">
                        {a.timestamp ? new Date(a.timestamp).toLocaleString() : '-'}
                      </td>
                      <td className="p-4">
                        <div className="flex items-center gap-2 text-slate-300">
                           {getIcon(a.type)} 
                           <span className="text-xs">{a.type}</span>
                        </div>
                      </td>
                      <td className="p-4 text-white font-medium max-w-[180px] truncate" title={a.name}>{a.name}</td>
                      <td className="p-4 text-xs text-slate-300">{a.action}</td>
                      <td className="p-4 font-mono text-xs max-w-xs truncate text-slate-500" title={a.path}>{a.path}</td>
                      <td className="p-4 text-right">
                        <span className={`inline-flex px-2 py-1 rounded-full text-xs font-bold border ${getRiskColor(a.riskLevel)}`}>
                          {a.riskLevel}
                        </span>
                      </td>
                    </tr>
                  ))}
                  {filtered.length === 0 && <tr><td colSpan="6" className="p-12 text-center text-slate-600">분석된 데이터가 없습니다.</td></tr>}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      );
    };

    const AIAnalysis = ({ logs, artifacts }) => {
      const [messages, setMessages] = useState([{ role: 'ai', content: '데이터 분석 준비 완료. USB 기록이나 특이사항에 대해 질문해주세요.' }]);
      const [input, setInput] = useState('');
      const [loading, setLoading] = useState(false);
      const [apiKey, setApiKey] = useState(() => localStorage.getItem('GEMINI_API_KEY') || '');
      const [showKeyInput, setShowKeyInput] = useState(!apiKey);
      const [tempKey, setTempKey] = useState('');
      const scrollRef = useRef(null);

      useEffect(() => { if (scrollRef.current) scrollRef.current.scrollTop = scrollRef.current.scrollHeight; }, [messages]);

      const handleSaveKey = () => {
        if(tempKey.trim()) {
          localStorage.setItem('GEMINI_API_KEY', tempKey.trim());
          setApiKey(tempKey.trim());
          setShowKeyInput(false);
        }
      };

      const handleSend = async () => {
        if (!input.trim() || loading) return;
        if (!apiKey) { setShowKeyInput(true); return; }
        const userMsg = { role: 'user', content: input };
        setMessages(prev => [...prev, userMsg]);
        setInput('');
        setLoading(true);
        try {
          const res = await analyzeLogsWithGemini(logs, artifacts, userMsg.content, apiKey);
          setMessages(prev => [...prev, { role: 'ai', content: res }]);
        } catch (e) {
          setMessages(prev => [...prev, { role: 'ai', content: `오류: ${e.message}` }]);
        } finally {
          setLoading(false);
        }
      };

      return (
        <div className="flex flex-col h-[calc(100vh-140px)] bg-slate-900 border border-slate-800 rounded-xl overflow-hidden pb-10 md:pb-0 shadow-2xl">
          <div className="p-4 border-b border-slate-800 flex justify-between items-center bg-slate-800/50">
            <div className="flex items-center gap-2 font-bold text-white"><Icons.Sparkles className="text-cyan-400 w-5 h-5"/> Gemini AI</div>
            <button onClick={() => setShowKeyInput(!showKeyInput)} className="text-xs bg-slate-800 px-3 py-1 rounded text-slate-300 border border-slate-700 hover:text-white transition-colors">
              <Icons.Key className="w-3 h-3 inline mr-1"/> {apiKey ? '키 변경' : '키 설정'}
            </button>
          </div>
          {showKeyInput && (
            <div className="p-4 bg-slate-800 space-y-3 border-b border-slate-700 animate-fade-in">
              <div className="flex flex-col md:flex-row gap-2">
                <input type="password" placeholder="API Key 입력" value={tempKey} onChange={e=>setTempKey(e.target.value)} className="flex-1 bg-slate-950 border border-slate-600 rounded px-3 py-2 text-sm text-white focus:outline-none focus:border-cyan-500"/>
                <button onClick={handleSaveKey} className="bg-cyan-600 text-white px-4 py-2 rounded text-sm hover:bg-cyan-500 transition-colors"><Icons.Save className="w-3 h-3 inline mr-1"/>저장</button>
              </div>
              <a href="https://aistudio.google.com/app/apikey" target="_blank" className="text-xs text-cyan-400 hover:underline flex items-center gap-1">
                 Google AI Studio에서 키 발급받기 <Icons.ExternalLink className="w-3 h-3"/>
              </a>
            </div>
          )}
          <div className="flex-1 overflow-y-auto p-4 space-y-4" ref={scrollRef}>
            {messages.map((m, i) => (
              <div key={i} className={`flex gap-3 ${m.role === 'user' ? 'flex-row-reverse' : ''}`}>
                 <div className={`p-2 rounded-full h-8 w-8 flex items-center justify-center flex-shrink-0 ${m.role === 'user' ? 'bg-indigo-500/20' : 'bg-cyan-500/20'}`}>
                    {m.role === 'user' ? <Icons.User className="w-4 h-4 text-indigo-400"/> : <Icons.Bot className="w-4 h-4 text-cyan-400"/>}
                 </div>
                <div className={`p-3 rounded-lg max-w-[85%] text-sm whitespace-pre-wrap leading-relaxed shadow-md ${m.role === 'user' ? 'bg-indigo-600/20 text-indigo-100' : 'bg-slate-800 text-slate-200'}`}>
                  {m.content}
                </div>
              </div>
            ))}
            {loading && (
              <div className="flex gap-3">
                 <div className="p-2 rounded-full h-8 w-8 bg-cyan-500/20 flex items-center justify-center flex-shrink-0"><Icons.Bot className="w-4 h-4 text-cyan-400"/></div>
                 <div className="bg-slate-800 rounded-lg p-3 text-sm text-slate-400 animate-pulse">AI가 분석 중입니다...</div>
              </div>
            )}
          </div>
          <div className="p-4 bg-slate-800/50 border-t border-slate-800 flex gap-2">
            <input className="flex-1 bg-slate-900 border border-slate-700 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-cyan-500 transition-colors" 
                   placeholder={apiKey ? "질문을 입력하세요..." : "API Key를 먼저 설정해주세요"} 
                   value={input} onChange={e => setInput(e.target.value)} onKeyDown={e => e.key === 'Enter' && handleSend()} 
                   disabled={!apiKey}
            />
            <button onClick={handleSend} disabled={!apiKey || !input.trim()} className="bg-cyan-600 text-white p-3 rounded-lg hover:bg-cyan-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"><Icons.Send className="w-5 h-5"/></button>
          </div>
        </div>
      );
    };

    const FileUpload = ({ onStartAnalysis, onDownloadScript }) => {
      const fileInputRef = useRef(null);
      const [isDragging, setIsDragging] = useState(false);
      const [error, setError] = useState(null);
      const [tempData, setTempData] = useState(null);

      const parseJSON = (text, fileName) => {
        try {
          const data = JSON.parse(text);
          let logs = [], artifacts = [];
          if (data.logs || data.artifacts) {
             logs = data.logs || [];
             artifacts = data.artifacts || [];
          } else if (Array.isArray(data)) {
             logs = data;
          } else throw new Error("형식이 올바르지 않습니다.");
          setTempData({ logs, artifacts, fileName });
          setError(null);
        } catch(e) {
          setError("유효한 JSON 파일이 아닙니다.");
          setTempData(null);
        }
      };

      const handleFile = (e) => { const file = e.target.files?.[0]; if(file) readFile(file); };
      const readFile = (file) => { const reader = new FileReader(); reader.onload = (e) => parseJSON(e.target.result, file.name); reader.readAsText(file); };
      
      return (
        <div className="max-w-4xl mx-auto space-y-8 mt-4 md:mt-10 animate-fade-in px-4 pb-20 md:pb-0">
          <div className="text-center space-y-4">
            <h1 className="text-3xl md:text-4xl font-bold text-white tracking-tight">LogSentinel AI</h1>
            <p className="text-slate-400">디지털 포렌식 & 로그 분석 시스템</p>
          </div>

          <div className="bg-slate-900 border border-slate-800 p-6 md:p-8 rounded-xl space-y-6 shadow-2xl">
            {!tempData ? (
              <div 
                className={`border-2 border-dashed rounded-xl p-8 md:p-16 flex flex-col items-center justify-center cursor-pointer transition-all duration-200 group ${isDragging ? 'border-cyan-500 bg-cyan-500/10' : 'border-slate-700 hover:border-cyan-500/50 hover:bg-slate-800/50'}`}
                onClick={()=>fileInputRef.current?.click()}
                onDragOver={(e)=>{e.preventDefault(); setIsDragging(true)}}
                onDragLeave={()=>setIsDragging(false)}
                onDrop={(e)=>{e.preventDefault(); setIsDragging(false); if(e.dataTransfer.files[0]) readFile(e.dataTransfer.files[0]);}}
              >
                <input type="file" ref={fileInputRef} onChange={handleFile} className="hidden" accept=".json"/>
                <div className="w-16 h-16 bg-slate-800 rounded-full flex items-center justify-center mb-6 text-cyan-500 group-hover:scale-110 transition-transform shadow-lg">
                   <Icons.UploadCloud className="w-8 h-8"/>
                </div>
                <p className="text-slate-200 font-bold text-xl mb-2">데이터 파일 업로드</p>
                <p className="text-slate-500 text-sm mb-4">forensics_data.json 파일을 이곳에 드래그하세요</p>
                {error && <div className="text-red-400 text-sm bg-red-900/20 px-4 py-2 rounded-lg border border-red-900/50 flex items-center gap-2"><Icons.AlertTriangle className="w-4 h-4"/>{error}</div>}
              </div>
            ) : (
              <div className="border border-cyan-500/30 bg-cyan-500/5 rounded-xl p-8 flex flex-col items-center text-center animate-fade-in">
                <Icons.CheckCircle className="w-16 h-16 text-green-500 mb-4 drop-shadow-lg"/>
                <h3 className="text-xl font-bold text-white mb-2">분석 준비 완료</h3>
                <p className="text-cyan-300 mb-8 font-mono text-sm break-all bg-cyan-950/30 px-3 py-1 rounded">{tempData.fileName}</p>
                <div className="flex flex-col md:flex-row gap-4 w-full md:w-auto">
                  <button onClick={() => onStartAnalysis(tempData.logs, tempData.artifacts)} className="bg-cyan-600 text-white px-8 py-3 rounded-xl font-bold hover:bg-cyan-500 flex items-center justify-center gap-2 shadow-lg shadow-cyan-500/20 transition-all hover:scale-105">
                    <Icons.ScanSearch className="w-5 h-5"/> 정밀 포렌식 분석 시작
                  </button>
                  <button onClick={() => setTempData(null)} className="bg-slate-800 text-slate-400 px-8 py-3 rounded-xl hover:text-white hover:bg-slate-700 transition-colors">취소</button>
                </div>
              </div>
            )}

            <div className="pt-6 border-t border-slate-800">
              <button onClick={onDownloadScript} className="w-full bg-slate-800/50 text-slate-300 p-4 rounded-xl border border-slate-700 hover:bg-slate-800 flex items-center justify-center gap-3 hover:text-white transition-all group">
                <div className="bg-slate-700 p-1.5 rounded text-green-400 group-hover:text-green-300"><Icons.Terminal className="w-5 h-5"/></div>
                <span className="font-medium">데이터 수집기(PowerShell) 다운로드</span>
                <Icons.Download className="w-4 h-4 opacity-50 group-hover:opacity-100"/>
              </button>
              <p className="text-center text-xs text-slate-500 mt-3">
                * 이 스크립트는 PC의 USB, Recent Docs, Shellbags 데이터를 수집하며, 외부로 전송하지 않고 로컬 JSON 파일로 저장합니다.
              </p>
            </div>
          </div>
        </div>
      );
    };

    const App = () => {
      const [view, setView] = useState('UPLOAD');
      const [logs, setLogs] = useState([]);
      const [artifacts, setArtifacts] = useState([]);
      const [scanning, setScanning] = useState(false);
      const [scanStep, setScanStep] = useState(0);
      const [sidebarOpen, setSidebarOpen] = useState(false);

      const startScanSequence = (targetLogs, targetArtifacts) => {
        setScanning(true);
        setScanStep(0);
        const steps = [
           () => setScanStep(1), () => setScanStep(2), () => setScanStep(3), () => setScanStep(4),
           () => {
             setLogs(targetLogs);
             setArtifacts(targetArtifacts);
             setScanning(false);
             setView('FORENSICS'); 
           }
        ];
        let current = 0;
        const interval = setInterval(() => {
          if (current < steps.length) { steps[current](); current++; } else { clearInterval(interval); }
        }, 800); 
      };

      const handleDownloadScript = () => {
        // Correctly escaped PowerShell script for JS template literal
        const script = `
\$ErrorActionPreference = "SilentlyContinue"
[Console]::OutputEncoding = [System.Text.Encoding]::UTF8
Write-Host "LogSentinel Forensic Collector Started..." -ForegroundColor Cyan

\$data = @{ logs = @(); artifacts = @() }

function Add-Artifact {
    param(\$type, \$name, \$path, \$action, \$risk, \$timestamp)
    \$ts = if (\$timestamp) { \$timestamp } else { (Get-Date).ToString("o") }
    \$data.artifacts += @{
        id = [Guid]::NewGuid().ToString()
        timestamp = \$ts
        type = \$type
        name = \$name
        path = \$path
        action = \$action
        riskLevel = \$risk
    }
}

# ============================================
# Known Folder GUID -> 실제 경로 매핑
# ============================================
\$KnownFolders = @{
    # 주요 시스템 폴더 GUID
    "{B4BFCC3A-DB2C-424C-B029-7FE99A87C641}" = [Environment]::GetFolderPath('Desktop')
    "{FDD39AD0-238F-46AF-ADB4-6C85480369C7}" = [Environment]::GetFolderPath('MyDocuments')
    "{374DE290-123F-4565-9164-39C4925E467B}" = "\$env:USERPROFILE\\Downloads"
    "{33E28130-4E1E-4676-835A-98395C3BC3BB}" = [Environment]::GetFolderPath('MyPictures')
    "{18989B1D-99B5-455B-841C-AB7C74E4DDFC}" = [Environment]::GetFolderPath('MyVideos')
    "{4BD8D571-6D19-48D3-BE97-422220080E43}" = [Environment]::GetFolderPath('MyMusic')
    "{1777F761-68AD-4D8A-87BD-30B759FA33DD}" = [Environment]::GetFolderPath('Favorites')
    "{BFB9D5E0-C6A9-404C-B2B2-AE6DB6AF4968}" = "\$env:USERPROFILE\\Links"
    "{56784854-C6CB-462B-8169-88E350ACB882}" = "\$env:USERPROFILE\\Contacts"
    "{A520A1A4-1780-4FF6-BD18-167343C5AF16}" = "\$env:USERPROFILE\\AppData\\LocalLow"
    "{625B53C3-AB48-4EC1-BA1F-A1EF4146FC19}" = "\$env:APPDATA\\Microsoft\\Windows\\Start Menu"
    "{AE50C081-EBD2-438A-8655-8A092E34987A}" = "\$env:APPDATA\\Microsoft\\Windows\\Recent"
    "{3D644C9B-1FB8-4F30-9B45-F670235F79C0}" = "\$env:PUBLIC\\Downloads"
    "{DFDF76A2-C82A-4D63-906A-5644AC457385}" = "\$env:PUBLIC"
    "{0762D272-C50A-4BB0-A382-697DCD729B80}" = "\$env:USERPROFILE"
    "{5E6C858F-0E22-4760-9AFE-EA3317B67173}" = "\$env:USERPROFILE"
    "{F38BF404-1D43-42F2-9305-67DE0B28FC23}" = "\$env:SystemRoot"
    "{1AC14E77-02E7-4E5D-B744-2EB1AE5198B7}" = "\$env:SystemRoot\\System32"
    "{D65231B0-B2F1-4857-A4CE-A8E7C6EA7D27}" = "\$env:SystemRoot\\System32"
    "{905E63B6-C1BF-494E-B29C-65B732D3D21A}" = "\$env:ProgramFiles"
    "{6D809377-6AF0-444B-8957-A3773F02200E}" = "\${env:ProgramFiles(x86)}"
    "{DE61D971-5EBC-4F02-A3A9-6C82895E5C04}" = "\$env:USERPROFILE\\OneDrive"
    "{20D04FE0-3AEA-1069-A2D8-08002B30309D}" = "This PC"
    "{5399E694-6CE5-4D6C-8FCE-1D8870FDCBA0}" = "\$env:USERPROFILE"
}

# ============================================
# Shellbag 바이너리 파싱 함수
# ============================================
function Parse-ShellItem {
    param([byte[]]\$bytes)
    
    if (-not \$bytes -or \$bytes.Length -lt 4) { return \$null }
    
    \$result = @{
        FolderName = \$null
        FullPath = \$null
        FolderType = "Unknown"
    }
    
    try {
        \$size = [BitConverter]::ToUInt16(\$bytes, 0)
        if (\$size -lt 3) { return \$null }
        
        \$type = \$bytes[2]
        
        # 드라이브
        if (\$type -in @(0x2F, 0x23, 0x25, 0x29, 0x2E)) {
            \$result.FolderType = "Drive"
            if (\$bytes.Length -gt 3) {
                \$driveLetter = [char]\$bytes[3]
                if (\$driveLetter -match '[A-Za-z]') {
                    \$result.FolderName = "\${driveLetter}:"
                    \$result.FullPath = "\${driveLetter}:\\"
                }
            }
        }
        # GUID 폴더
        elseif (\$type -eq 0x1F -and \$bytes.Length -ge 18) {
            \$result.FolderType = "Special Folder"
            try {
                \$guidBytes = \$bytes[4..19]
                \$guid = [Guid]::new(\$guidBytes)
                \$guidStr = "{\$([string]\$guid).ToUpper()}"
                
                if (\$KnownFolders.ContainsKey(\$guidStr)) {
                    \$result.FullPath = \$KnownFolders[\$guidStr]
                    \$result.FolderName = Split-Path \$result.FullPath -Leaf
                    if (-not \$result.FolderName) { \$result.FolderName = \$result.FullPath }
                } else {
                    \$result.FolderName = "GUID: \$guidStr"
                    \$result.FullPath = \$guidStr
                }
            } catch {
                \$result.FolderName = "Special Folder"
            }
        }
        # 일반 폴더
        elseif (\$type -in @(0x32, 0x36, 0x3A, 0x34, 0x35, 0x31, 0x30, 0x74, 0x76)) {
            \$result.FolderType = if (\$type -in @(0x74, 0x76)) { "File" } else { "Folder" }
            
            \$unicodeName = ""
            
            for (\$i = 4; \$i -lt \$bytes.Length - 10; \$i++) {
                if (\$bytes[\$i] -ge 0x04 -and \$bytes[\$i] -le 0x09 -and \$bytes[\$i+1] -eq 0x00) {
                     # Logic to find unicode end would go here
                }
            }
            
            # Simple Unicode Extraction from end
            for (\$i = [Math]::Min(\$bytes.Length - 2, 200); \$i -gt 10; \$i -= 2) {
                if (\$bytes[\$i] -eq 0 -and \$bytes[\$i+1] -eq 0) {
                    \$strEnd = \$i
                    \$strStart = \$i
                    for (\$j = \$i - 2; \$j -gt 4; \$j -= 2) {
                        \$char = [BitConverter]::ToUInt16(\$bytes, \$j)
                        if (\$char -ge 32 -and \$char -lt 65535 -and \$char -ne 0xFFFF) {
                            \$strStart = \$j
                        } else {
                            break
                        }
                    }
                    if (\$strEnd - \$strStart -ge 4) {
                        try {
                            \$unicodeName = [System.Text.Encoding]::Unicode.GetString(\$bytes[\$strStart..\$strEnd])
                            \$unicodeName = \$unicodeName.Trim([char]0)
                            if (\$unicodeName.Length -gt 1 -and \$unicodeName -notmatch '[\\x00-\\x1F]') {
                                \$result.FolderName = \$unicodeName
                                break
                            }
                        } catch {}
                    }
                }
            }
            
            if (-not \$result.FolderName) {
                \$asciiName = ""
                \$inString = \$false
                for (\$i = 3; \$i -lt [Math]::Min(\$bytes.Length, 50); \$i++) {
                    \$b = \$bytes[\$i]
                    if (\$b -ge 32 -and \$b -lt 127) {
                        \$asciiName += [char]\$b
                        \$inString = \$true
                    } elseif (\$inString -and \$b -eq 0 -and \$asciiName.Length -gt 1) {
                        break
                    } elseif (\$b -eq 0 -and \$asciiName.Length -gt 0) {
                    } else {
                        \$asciiName = ""
                        \$inString = \$false
                    }
                }
                if (\$asciiName.Length -gt 1) {
                    \$result.FolderName = \$asciiName.Trim()
                }
            }
        }
        
    } catch {}
    
    if (\$result.FolderName) {
        \$result.FolderName = \$result.FolderName -replace '[\\x00-\\x1F]', ''
        \$result.FolderName = \$result.FolderName.Trim()
    }
    
    return \$result
}

function Parse-BagMRU {
    param([string]\$regPath, [string]\$parentFullPath = "", [int]\$depth = 0)
    
    if (\$depth -gt 15 -or -not (Test-Path \$regPath)) { return }
    
    try {
        \$props = Get-ItemProperty -Path \$regPath -ErrorAction SilentlyContinue
        \$key = Get-Item -Path \$regPath -ErrorAction SilentlyContinue
        
        \$key.Property | Where-Object { \$_ -match '^\d+\$' } | Sort-Object { [int]\$_ } | ForEach-Object {
            \$valueName = \$_
            \$bytes = \$props.\$valueName
            
            if (\$bytes -and \$bytes -is [byte[]]) {
                \$parsed = Parse-ShellItem -bytes \$bytes
                
                if (\$parsed -and \$parsed.FolderName) {
                    if (\$parsed.FullPath) {
                        \$fullPath = \$parsed.FullPath
                    } elseif (\$parentFullPath) {
                        \$fullPath = Join-Path \$parentFullPath \$parsed.FolderName
                    } else {
                        \$fullPath = \$parsed.FolderName
                    }
                    
                    \$fullPath = \$fullPath -replace '\\\\\\\\', '\\\\'
                    
                    \$ts = (Get-Date).ToString("o")
                    try {
                        \$subKeyPath = "\$regPath\\\$valueName"
                        if (Test-Path \$subKeyPath) {
                            \$subKey = Get-Item \$subKeyPath -ErrorAction SilentlyContinue
                            if (\$subKey.LastWriteTime) {
                                \$ts = \$subKey.LastWriteTime.ToString("o")
                            }
                        }
                    } catch {}
                    
                    Add-Artifact "SHELLBAG" \$parsed.FolderName \$fullPath "Type: \$(\$parsed.FolderType)" "MEDIUM" \$ts
                    
                    \$subKeyPath = "\$regPath\\\$valueName"
                    if (Test-Path \$subKeyPath) {
                        \$nextParent = if (\$parsed.FullPath) { \$parsed.FullPath } else { \$fullPath }
                        Parse-BagMRU -regPath \$subKeyPath -parentFullPath \$nextParent -depth (\$depth + 1)
                    }
                }
            }
        }
    } catch {}
}

# 1. RECENT DOCS
Write-Host "[-] Scanning Recent Docs..." -NoNewline
try {
    \$wsh = New-Object -ComObject WScript.Shell
    \$recentPath = [Environment]::GetFolderPath('Recent')
    Get-ChildItem \$recentPath -Filter "*.lnk" -ErrorAction SilentlyContinue | Sort-Object LastWriteTime -Descending | Select-Object -First 50 | ForEach-Object {
        try {
            \$sc = \$wsh.CreateShortcut(\$_.FullName)
            if (\$sc.TargetPath) { 
                Add-Artifact "RECENT_DOC" \$_.BaseName \$sc.TargetPath "LNK Target" "MEDIUM" \$_.LastWriteTime.ToString("o") 
            }
        } catch {}
    }
    [System.Runtime.Interopservices.Marshal]::ReleaseComObject(\$wsh) | Out-Null
    Write-Host " Done." -ForegroundColor Green
} catch { Write-Host " Error." -ForegroundColor Red }

# 2. SHELLBAG
Write-Host "[-] Scanning Shellbags..." -NoNewline
try {
    \$shellbagPaths = @("HKCU:\\Software\\Microsoft\\Windows\\Shell\\BagMRU", "HKCU:\\Software\\Classes\\Local Settings\\Software\\Microsoft\\Windows\\Shell\\BagMRU")
    foreach (\$path in \$shellbagPaths) {
        if (Test-Path \$path) { Parse-BagMRU -regPath \$path -parentFullPath "" -depth 0 }
    }
    Write-Host " Done." -ForegroundColor Green
} catch { Write-Host " Error: \$_" -ForegroundColor Red }

# 3. EXPLORER HISTORY
Write-Host "[-] Scanning Explorer History..." -NoNewline
try {
    \$typedPathsReg = "HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\TypedPaths"
    if (Test-Path \$typedPathsReg) {
        \$props = Get-ItemProperty \$typedPathsReg
        \$props.PSObject.Properties | Where-Object { \$_.Name -match "^url\d+" } | ForEach-Object {
            if (\$_.Value) { 
                \$folderName = Split-Path \$_.Value -Leaf
                if (-not \$folderName) { \$folderName = \$_.Value }
                Add-Artifact "EXPLORER_HISTORY" \$folderName \$_.Value "Address Bar" "MEDIUM" 
            }
        }
    }
    \$runMRUReg = "HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\RunMRU"
    if (Test-Path \$runMRUReg) {
        \$props = Get-ItemProperty \$runMRUReg
        \$props.PSObject.Properties | Where-Object { \$_.Name -match "^[a-z]\$" } | ForEach-Object {
            if (\$_.Value) { 
                \$cmd = \$_.Value -replace "\\\\1\$", ""
                Add-Artifact "EXPLORER_HISTORY" \$cmd \$cmd "Run Command" "HIGH" 
            }
        }
    }
    Write-Host " Done." -ForegroundColor Green
} catch { Write-Host " Error." -ForegroundColor Red }

# 4. USB HISTORY
Write-Host "[-] Scanning USB History..." -NoNewline
try {
    \$devs = Get-PnpDevice -Class 'USB' -ErrorAction SilentlyContinue | Where-Object { \$_.FriendlyName -and \$_.FriendlyName -notmatch 'Hub|Controller|Composite|Root|Intel|AMD|Host|Virtual' }
    foreach (\$d in \$devs) {
        \$lastDate = "Unknown"
        \$ts = (Get-Date).ToString("o")
        try {
            \$p = Get-PnpDeviceProperty -InstanceId \$d.InstanceId -KeyName "{83da6326-97a6-4088-9453-a1923f573b29} 102" -ErrorAction SilentlyContinue
            if (\$p.Data) { 
                \$dt = [DateTime]\$p.Data
                \$lastDate = \$dt.ToString("yyyy-MM-dd HH:mm:ss")
                \$ts = \$dt.ToString("o") 
            }
        } catch {}
        Add-Artifact "USB_DEVICE" \$d.FriendlyName \$d.InstanceId "Last: \$lastDate" "HIGH" \$ts
    }
    Write-Host " Done." -ForegroundColor Green
} catch { Write-Host " Error." -ForegroundColor Red }

# SAVE
\$out = "\$PWD\\forensics_data.json"
\$data | ConvertTo-Json -Depth 5 | Out-File \$out -Encoding utf8
Write-Host "[+] Saved to: \$out" -ForegroundColor Green
Start-Sleep -Seconds 3
`;
        const blob = new Blob([script], { type: 'text/plain' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'collect_data.ps1';
        document.body.appendChild(a); a.click(); document.body.removeChild(a);
      };

      if(scanning) {
         const msgs = ["데이터 분석 초기화...", "시스템 로그 파싱 중...", "레지스트리 아티팩트 정밀 분석...", "USB 장치 이력 스캔...", "최근 접근 파일 및 위험도 평가...", "보고서 생성 중..."];
         return (
          <div className="h-screen bg-slate-950 flex flex-col items-center justify-center text-white space-y-8 p-4">
            <div className="relative w-24 h-24">
               <div className="absolute inset-0 border-4 border-slate-800 rounded-full"></div>
               <div className="absolute inset-0 border-4 border-cyan-500 rounded-full border-t-transparent animate-spin"></div>
               <div className="absolute inset-0 flex items-center justify-center text-cyan-400"><Icons.Activity className="w-8 h-8"/></div>
            </div>
            <div className="text-center">
              <h2 className="text-2xl font-bold mb-2">정밀 포렌식 분석 중</h2>
              <p className="text-cyan-400 font-mono text-sm">{msgs[scanStep]}</p>
            </div>
            <div className="w-64 bg-slate-900 rounded-full h-1"><div className="bg-cyan-500 h-full transition-all duration-300" style={{width: `${(scanStep/5)*100}%`}}></div></div>
          </div>
         );
      }

      const NavBtn = ({ id, label, icon }) => (
        <button onClick={() => { setView(id); setSidebarOpen(false); }} className={`flex items-center gap-3 w-full p-3 rounded-lg ${view === id ? 'bg-cyan-500/10 text-cyan-400' : 'text-slate-400 hover:text-white'}`}>
          {icon} <span className="md:inline">{label}</span>
        </button>
      );

      return (
        <div className="flex flex-col md:flex-row h-screen bg-slate-950 text-slate-100 overflow-hidden">
          <div className="md:hidden h-16 bg-slate-900 border-b border-slate-800 flex items-center justify-between px-4 z-20 shrink-0 shadow-md">
             <div className="font-bold text-cyan-400 flex items-center gap-2"><Icons.Activity className="w-5 h-5"/> LogSentinel</div>
             <button onClick={()=>setSidebarOpen(!sidebarOpen)} className="text-slate-400 p-2"><Icons.Menu className="w-6 h-6"/></button>
          </div>

          <aside className={`
            fixed inset-y-0 left-0 bg-slate-900 border-r border-slate-800 z-10 transition-transform duration-300 shadow-2xl
            ${sidebarOpen ? 'translate-x-0' : '-translate-x-full'}
            md:relative md:translate-x-0 md:w-64 flex flex-col w-64
          `}>
            <div className="hidden md:flex p-6 border-b border-slate-800 items-center gap-2 text-cyan-400 font-bold text-xl"><Icons.Activity className="w-6 h-6"/> LogSentinel</div>
            <nav className="flex-1 p-4 space-y-2">
              <NavBtn id="UPLOAD" label="파일 업로드" icon={<Icons.UploadCloud className="w-5 h-5"/>}/>
              {(logs.length > 0 || artifacts.length > 0) && <>
                <div className="pt-4 pb-2 px-3 text-xs font-bold text-slate-500 uppercase tracking-wider">분석 결과</div>
                <NavBtn id="FORENSICS" label="포렌식 결과" icon={<Icons.ShieldAlert className="w-5 h-5"/>}/>
                <NavBtn id="ANALYSIS" label="AI 챗봇" icon={<Icons.BrainCircuit className="w-5 h-5"/>}/>
              </>}
            </nav>
            <div className="p-4 border-t border-slate-800">
              <button onClick={() => window.location.reload()} className="flex items-center gap-3 w-full p-3 rounded-lg text-slate-400 hover:bg-slate-800 hover:text-white transition-colors"><Icons.LogOut className="w-5 h-5"/> 초기화</button>
            </div>
          </aside>
          
          {sidebarOpen && <div className="fixed inset-0 bg-black/50 z-0 md:hidden" onClick={()=>setSidebarOpen(false)}></div>}

          <main className="flex-1 overflow-auto bg-slate-950 p-4 md:p-8 relative w-full">
            {view === 'UPLOAD' && <FileUpload onStartAnalysis={startScanSequence} onDownloadScript={handleDownloadScript}/>}
            {view === 'FORENSICS' && <ForensicsView artifacts={artifacts}/>}
            {view === 'ANALYSIS' && <AIAnalysis logs={logs} artifacts={artifacts}/>}
          </main>
        </div>
      );
    };

    const waitForGlobals = () => {
      if (window.React && window.ReactDOM) {
         const root = ReactDOM.createRoot(document.getElementById('root'));
         root.render(<App />);
      } else {
        setTimeout(waitForGlobals, 100);
      }
    };
    waitForGlobals();
  </script>
</body>
</html>
